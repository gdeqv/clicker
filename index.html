<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Мега Кликер Супер пупер про макс</title>
<style>
  body { font-family: Arial, sans-serif; text-align: center; margin: 50px; background: #f0f0f0; }
  #game { display: none; }
  button { padding: 10px 20px; margin: 5px; font-size: 16px; cursor: pointer; }
  input { padding: 5px; font-size: 14px; }
  #achievements { margin-top: 20px; }
  #leaderboard { margin-top: 20px; text-align: left; display: inline-block; }
</style>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

</head>
<body>

<h1>Мега Кликер Супер пупер про макс</h1>

<div id="register">
  <h2>Регистрация</h2>
  <input type="text" id="username" placeholder="Имя игрока">
  <button onclick="register()">Старт</button>
</div>

<div id="game">
  <h2 id="greeting"></h2>
  <button onclick="clicker()">Клик!</button>
  <p>Клики: <span id="clickCount">0</span></p>
  <div id="achievements">
    <h3>Достижения</h3>
    <ul id="achieveList"></ul>
  </div>
  <div id="leaderboard">
    <h3>Топ игроков</h3>
    <ol id="topList"></ol>
  </div>
</div>

<script>
let username = '';
let clicks = 0;
let achievements = [];

// === Firebase ===
const firebaseConfig = {
  apiKey: "AIzaSyCPi_PDlqc-LHqlYdV1x_PVK4QNl6MR3EQ",
  authDomain: "clicker-53a30.firebaseapp.com",
  projectId: "clicker-53a30",
  storageBucket: "clicker-53a30.firebasestorage.app",
  messagingSenderId: "527741807824",
  appId: "1:527741807824:web:2e406b6da947da80ac02d5",
  measurementId: "G-0R1VWR50GD"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// === Регистрация игрока ===
function register() {
  const input = document.getElementById('username');
  if(input.value.trim() === '') {
    alert('Введите имя!');
    return;
  }
  username = input.value.trim();

  // Локальные данные
  const savedData = localStorage.getItem(username);
  if(savedData) {
    const data = JSON.parse(savedData);
    clicks = data.clicks;
    achievements = data.achievements;
  }

  document.getElementById('register').style.display = 'none';
  document.getElementById('game').style.display = 'block';
  document.getElementById('greeting').innerText = `Привет, ${username}! Добро пожаловать в Мега Кликер Супер пупер про макс!`;
  updateUI();
}

// === Кликер ===
function clicker() {
  clicks++;
  checkAchievements();
  saveData();
  updateUI();
}

// === Достижения ===
function checkAchievements() {
  const thresholds = [10, 50, 100, 500];
  thresholds.forEach(thr => {
    if(clicks >= thr && !achievements.includes(thr)) {
      achievements.push(thr);
      alert(`Достижение: ${thr} кликов!`);
    }
  });
}

// === Сохранение данных ===
function saveData() {
  const data = { clicks, achievements };
  localStorage.setItem(username, JSON.stringify(data)); // локально
  db.ref('players/' + username).set(data); // Firebase
  updateLeaderboard();
}

// === Обновление интерфейса ===
function updateUI() {
  document.getElementById('clickCount').innerText = clicks;
  const achieveList = document.getElementById('achieveList');
  achieveList.innerHTML = '';
  achievements.forEach(a => {
    const li = document.createElement('li');
    li.textContent = `${a} кликов`;
    achieveList.appendChild(li);
  });
  updateLeaderboard();
}

// === Топ игроков ===
function updateLeaderboard() {
  const topList = document.getElementById('topList');
  topList.innerHTML = '';

  db.ref('players').orderByChild('clicks').limitToLast(5).once('value', snapshot => {
    let players = [];
    snapshot.forEach(child => {
      players.push({ name: child.key, clicks: child.val().clicks });
    });

    players.sort((a,b) => b.clicks - a.clicks);

    players.forEach(p => {
      const li = document.createElement('li');
      li.textContent = `${p.name} - ${p.clicks}`;
      topList.appendChild(li);
    });
  });
}

// Обновление топа каждые 5 секунд (чтобы видеть клики всех игроков)
setInterval(updateLeaderboard, 5000);
</script>

</body>
</html>
